<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>BLUEPEN CALENDAR</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/calendar.css">
  <!-- Font Awesome CDN 추가 -->
  <link rel="stylesheet"
   href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
  />
  <!-- FullCalendar 스타일시트 -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">
  <!-- FullCalendar 자바스크립트 -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
  <!-- 한국어 로케일 파일 -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/locales/ko.js"></script>
</head>
<body>
<div id="calendar"></div>
<script>
document.addEventListener('DOMContentLoaded', function () {
    var calendarEl = document.getElementById('calendar');
    
    // Spring Boot에서 전달된 plans 데이터를 JavaScript 배열로 변환
    var events = [];
    
    // 'plans' 데이터가 비어있지 않다면
    var plans = /*[[${plans}]]*/ '';  // Spring Boot에서 전달한 plans 변수를 여기에 넣음

    if (plans && plans.trim() !== "") {
        // 쉼표로 구분된 마감일 데이터 분리
        var deadlines = plans.split(',');

        deadlines.forEach(function(deadline) {
            var deadlineParts = deadline.trim().split(' ');  // 공고명, 회사명, 마감일 분리
            var company = deadlineParts[0];
            var jobTitle = deadlineParts[1];
            var deadlineDate = deadlineParts[2];

            events.push({
                title: "회사명: " + company + " 공고명: " + jobTitle,  // 제목에 회사명과 공고명 추가
                start: deadlineDate,  // 마감일을 시작일로 설정
                allDay: true  // 마감일은 하루 종일 일정으로 표시
            });
        });
    }

    // FullCalendar 초기화
    var calendar = new FullCalendar.Calendar(calendarEl, {
        plugins: ['dayGrid', 'interaction'],
        initialView: 'dayGridMonth',
        events: events  // 위에서 설정한 이벤트 배열을 추가
    });

    calendar.render();
});
    </script>

      <!-- 상단바, 사이드바 -->
    <header class="topbar" th:replace="~{topbar}"></header>
    <div class="sidebar" th:replace="~{sidebar}"></div>
    <div class="calendar-wrapper">
    <div id='calendar'></div>
    </div>
    
   <!-- 일정 추가 모달 -->
   <div id="eventModal" class="modal" >
     <div class="modal-content schedule-modal">
       <span id="closeModal" class="close">
         <i class="fa-solid fa-xmark"></i>
       </span>
       <h2 class="modal-title">일정 추가</h2>
   
       <input type="text" id="eventTitle" name="scheTitle" placeholder="일정 제목 입력" class="input-box" />
   
       <select id="eventType" name="scheType" class="input-box">
         <option value="자격증">자격증 일정</option>
         <option value="취업">취업 일정</option>
       </select>
   
       <input type="time" id="eventTime" name="scheTm" class="input-box" />
   
       <button id="addEventBtn" class="primary-btn">추가하기</button>
     </div>
   </div>

   <!-- 삭제 확인 모달 -->
   <div id="deleteModal" class="modal">
     <div class="modal-content confirm-modal">
       <span id="closeDeleteModal" class="close">
         <i class="fa-solid fa-xmark"></i>
       </span>
       <p class="confirm-text">정말 이 일정을 삭제하시겠습니까?</p>
       <div class="confirm-buttons">
         <button id="confirmDeleteBtn" class="btn btn-danger">삭제</button>
         <button id="cancelDeleteBtn" class="btn btn-cancel">취소</button>
       </div>
     </div>
   </div>
   
   <!-- 일정 상세 보기 모달 -->
<div id="viewModal" class="modal">
  <div class="modal-content schedule-modal">
    <span id="closeViewModal" class="close">
      <i class="fa-solid fa-xmark"></i>
    </span>
    <h2 class="modal-title">일정 상세 보기</h2>
    <p id="viewModalContent">내용을 불러오는 중...</p>
  </div>
</div>

    <script src="assets/js/calendar.js"></script>
</body>
</html>